{"version":3,"sources":["private/verify/verifyLoop.js"],"names":[],"mappings":"AAAA,CAAC,UAAU,OAAV,EAAmB;AAChB,QAAI,OAAO,MAAP,KAAkB,QAAlB,IAA8B,OAAO,OAAO,OAAP,KAAmB,QAA1B,EAAoC;AAClE,YAAI,IAAI,QAAQ,OAAR,EAAiB,OAAjB,CAAJ,CAD8D,IAC3B,MAAM,SAAN,EAAiB,OAAO,OAAP,GAAiB,CAAjB,CAArB;KADvC,MAGK,IAAI,OAAO,MAAP,KAAkB,UAAlB,IAAgC,OAAO,GAAP,EAAY;AACjD,eAAO,CAAC,SAAD,EAAY,SAAZ,EAAuB,OAAvB,EAAgC,aAAhC,EAA+C,YAA/C,EAA6D,SAA7D,EAAwE,WAAxE,EAAqF,QAArF,EAA+F,MAA/F,EAAuG,eAAvG,EAAwH,gBAAxH,EAA0I,aAA1I,CAAP,EAAiK,OAAjK,EADiD;KAAhD;CAJR,CAAD,CAOG,UAAU,OAAV,EAAmB,OAAnB,EAA4B;AAC3B,iBAD2B;;AAE3B,QAAI,OAAO,QAAQ,OAAR,CAAP,CAFuB;AAG3B,QAAI,SAAS,QAAQ,aAAR,CAAT,CAHuB;AAI3B,QAAI,YAAY,QAAQ,YAAR,CAAZ,CAJuB;AAK3B,QAAI,SAAS,QAAQ,SAAR,CAAT,CALuB;AAM3B,QAAI,YAAY,QAAQ,WAAR,CAAZ,CANuB;AAO3B,QAAI,SAAS,QAAQ,QAAR,CAAT,CAPuB;AAQ3B,QAAI,OAAO,QAAQ,MAAR,CAAP,CARuB;AAS3B,QAAI,gBAAgB,QAAQ,eAAR,CAAhB,CATuB;AAU3B,QAAI,iBAAiB,QAAQ,gBAAR,CAAjB,CAVuB;AAW3B,QAAI,cAAc,QAAQ,aAAR,CAAd,CAXuB;AAY3B,aAAS,UAAT,CAAoB,CAApB,EAAuB,EAAvB,EAA2B;cACf,aAAsB,EAAtB,WADe;cACH,QAAU,EAAV,MADG;;AAEvB,iBAAS,WAAT,GAAuB;AACnB,sBAAU,QAAV,CAAmB,EAAE,MAAM,CAAN,EAAS,IAAI,EAAJ,EAA9B,EAAwC,MAAM,cAAc,aAAd,CAA4B,KAA5B,CAAN,CAAxC,CADmB;SAAvB;AAGA,aAAK,MAAL,CAAY,UAAZ,EAAwB,KAAK,mBAAmB,CAAnB,EAAsB,WAAtB,CAAL,EAAyC,WAAjE,EALuB;KAA3B;AAOA,WAAO,cAAP,CAAsB,OAAtB,EAA+B,YAA/B,EAA6C,EAAE,OAAO,IAAP,EAA/C,EAnB2B;AAoB3B,YAAQ,OAAR,GAAkB,UAAlB,CApB2B;AAqB3B,aAAS,cAAT,CAAwB,CAAxB,EAA2B,EAA3B,EAA+B;cACnB,MAAyB,EAAzB,IADmB;cACd,WAAoB,EAApB,SADc;cACJ,QAAU,EAAV,MADI;;AAE3B,YAAI,OAAO,CAAP,EACA,UAAU,KAAV,CAAgB,UAAU,OAAV,KAAsB,CAAtB,EAAyB,GAAzC,EAA8C,KAAK,EAAE,kBAAF,CAAnD,CADJ;AAEA,2BAAmB,QAAnB,EAA6B,MAAM;AAC/B,sBAAU,OAAV,CAAkB,CAAlB,EAAqB,MAAM;AACvB,8BAAc,aAAd,CAA4B,KAA5B,EAAmC,KAAK,UAAL,CAAgB,KAAhB,CAAnC,EADuB;aAAN,CAArB,CAD+B;SAAN,CAA7B,CAJ2B;KAA/B;AAUA,YAAQ,cAAR,GAAyB,cAAzB,CA/B2B;AAgC3B,aAAS,kBAAT,OAA8C,MAA9C,EAAsD;YAAxB,uBAAwB;YAAf,eAAe;;AAClD,oBAAY,OAAZ,CAAoB,GAApB,EADkD;AAElD,eAAO,aAAP,CAAqB,OAArB,EAA8B,KAAK,EAAE,cAAF,CAAnC,CAFkD;AAGlD,uBAAe,kBAAf,CAAkC,OAAlC,EAA2C,MAA3C,EAHkD;KAAtD;AAKA,aAAS,WAAT,CAAqB,CAArB,EAAwB;cACZ,UAAiB,EAAjB,QADY;cACH,MAAQ,EAAR,IADG;;AAEpB,oBAAY,WAAZ,CAAwB,OAAxB,EAFoB;;4BAGS,KAAK,OAAL,CAAa,UAAU,MAAV,EAAkB,MAAM,UAAU,IAAV,CAAe,GAAf,EAAoB,KAAK,EAAE,cAAF,CAA/B,EAHxC;;cAGZ,0BAHY;cAGF,uBAAJ,GAHM;;AAIpB,YAAI,gBAAgB,OAAO,GAAP;AAChB,gBAAI,WAAW,CAAX,EACA,UAAU,KAAV,CAAgB,YAAY,IAAZ,EAAkB,GAAlC,EAAuC,KAAK,EAAE,kBAAF,CAA5C,CADJ,KAGI,UAAU,KAAV,CAAgB,YAAY,IAAZ,EAAkB,GAAlC,EAAuC,KAAK,EAAE,eAAF,CAA5C,CAHJ;eAIC;AACD,mBAAO,MAAP,CAAc,gBAAgB,OAAO,MAAP,CAA9B,CADC;AAED,sBAAU,KAAV,CAAgB,YAAY,IAAZ,EAAkB,KAAK,GAAL,EAAU,KAAK,EAAE,gBAAF,CAAjD,CAFC;SALL;AASA,YAAI,UAAU,UAAV,EAAsB;AACtB,sBAAU,OAAV,CAAkB,iBAAlB,CAAoC,GAApC,CAAwC,IAAxC,EADsB;AAEtB,sBAAU,OAAV,CAAkB,cAAlB,CAAiC,GAAjC,CAAqC,CAArC,EAFsB;SAA1B;KAbJ;AAkBA,YAAQ,WAAR,GAAsB,WAAtB,CAvD2B;CAA5B,CAPH","file":"private/verify/verifyLoop.js","sourcesContent":["(function (factory) {\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        var v = factory(require, exports); if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === 'function' && define.amd) {\n        define([\"require\", \"exports\", 'op/Op', '../ast/Loop', '../context', '../util', './context', './util', './SK', './verifyBlock', './verifyLocals', './verifyVal'], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    var Op_1 = require('op/Op');\n    var Loop_1 = require('../ast/Loop');\n    var context_1 = require('../context');\n    var util_1 = require('../util');\n    var context_2 = require('./context');\n    var util_2 = require('./util');\n    var SK_1 = require('./SK');\n    var verifyBlock_1 = require('./verifyBlock');\n    var verifyLocals_1 = require('./verifyLocals');\n    var verifyVal_1 = require('./verifyVal');\n    function verifyLoop(_, sk) {\n        const { opIteratee, block } = _;\n        function verifyBlock() {\n            context_2.withLoop({ loop: _, sk: sk }, () => verifyBlock_1.verifyBlockDo(block));\n        }\n        Op_1.caseOp(opIteratee, _ => withVerifyIteratee(_, verifyBlock), verifyBlock);\n    }\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = verifyLoop;\n    function verifyForAsync(_, sk) {\n        const { loc, iteratee, block } = _;\n        if (sk === 0)\n            context_1.check(context_2.funKind === 1, loc, _ => _.forAsyncNeedsAsync);\n        withVerifyIteratee(iteratee, () => {\n            context_2.withFun(1, () => {\n                verifyBlock_1.verifyBlockSK(block, SK_1.getBlockSK(block));\n            });\n        });\n    }\n    exports.verifyForAsync = verifyForAsync;\n    function withVerifyIteratee({ element, bag }, action) {\n        verifyVal_1.default(bag);\n        util_2.verifyNotLazy(element, _ => _.noLazyIteratee);\n        verifyLocals_1.verifyAndPlusLocal(element, action);\n    }\n    function verifyBreak(_) {\n        const { opValue, loc } = _;\n        verifyVal_1.verifyOpVal(opValue);\n        const { loop, sk: loopSK } = Op_1.orThrow(context_2.opLoop, () => context_1.fail(loc, _ => _.misplacedBreak));\n        if (loop instanceof Loop_1.For)\n            if (loopSK === 0)\n                context_1.check(opValue === null, loc, _ => _.breakCantHaveValue);\n            else\n                context_1.check(opValue !== null, loc, _ => _.breakNeedsValue);\n        else {\n            util_1.assert(loop instanceof Loop_1.ForBag);\n            context_1.check(opValue === null, this.loc, _ => _.breakValInForBag);\n        }\n        if (context_2.isInSwitch) {\n            context_2.results.loopsNeedingLabel.add(loop);\n            context_2.results.breaksInSwitch.add(_);\n        }\n    }\n    exports.verifyBreak = verifyBreak;\n});\n"],"sourceRoot":"/source/"}